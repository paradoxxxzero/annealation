(()=>{var d=(n,y,A,F,I,j,M,g,f,N,q)=>{if(isNaN(n[y+5])){let t=n[y+1];if(t!==null&&t!==A){let u=A*2,m=t*2,z=f[m]-f[u],r=f[m+1]-f[u+1],w=z*z+r*r;j&&w<g&&M.push([A,t]);let o=q[t]/(w+I);N[u]+=o*z,N[u+1]+=o*r}}else{let t=A*2,u=n[y+3]-f[t],m=n[y+4]-f[t+1],z=u*u+m*m;if(y.size*y.size<F*F*z){let w=n[y+2]/z;N[t]+=w*u,N[t+1]+=w*m}else for(let w=0,o=4;w<o;w++)d(n,n[y+w+5],A,F,I,j,M,g,f,N,q)}},k=(n,y,A,F,I,j,M,g,f,N,q)=>{if(isNaN(n[y+6])){let t=n[y+1];if(t!==null&&t!==A){let u=A*3,m=t*3,z=f[m]-f[u],r=f[m+1]-f[u+1],w=f[m+2]-f[u+2],o=z*z+r*r+w*w,B=Math.sqrt(o+I);j&&o<g&&M.push([A,t]);let b=q[t]/(B*B*B);N[u]+=b*z,N[u+1]+=b*r,N[u+2]+=b*w}}else{let t=A*3,u=n[y+3]-f[t],m=n[y+4]-f[t+1],z=n[y+5]-f[t+2],r=Math.sqrt(u*u+m*m+z*z);if(n[y]/r<F){let o=n[y+2]/(r*r*r);N[t]+=o*u,N[t+1]+=o*m,N[t+2]+=o*z}else for(let o=0,B=8;o<B;o++)k(n,n[y+o+6],A,F,I,j,M,g,f,N,q)}},x=(n,y,A,F,I,j,M,g,f,N,q)=>{if(isNaN(n[y+7])){let t=n[y+1];if(t!==null&&t!==A){let u=A*4,m=t*4,z=f[m]-f[u],r=f[m+1]-f[u+1],w=f[m+2]-f[u+2],o=f[m+3]-f[u+3],B=z*z+r*r+w*w+o*o,b=B+I;j&&B<g&&M.push([A,t]);let v=q[t]/(b*b);N[u]+=v*z,N[u+1]+=v*r,N[u+2]+=v*w,N[u+3]+=v*o}}else{let t=A*4,u=n[y+4]-f[t],m=n[y+4]-f[t+1],z=n[y+5]-f[t+2],r=n[y+6]-f[t+3],w=u*u+m*m+z*z+r*r;if(y.size*y.size<F*F*w){let B=n[y+2]/(w*w);N[t]+=B*u,N[t+1]+=B*m,N[t+2]+=B*z,N[t+3]+=B*r}else for(let B=0,b=16;B<b;B++)x(n,n[y+B+7],A,F,I,j,M,g,f,N,q)}};var C,D,E;onmessage=function(n){let[y,A,F,I,j,M,g,f,N]=n.data;if(n.data.length===3){let[m,z,r]=n.data;D=new Float32Array(z),C=new Float32Array(m),E=new Float32Array(r);return}let q=new Float32Array(N),t=[],u={2:d,3:k,4:x}[F];for(let m=y;m<A;m++){let z=m*F;for(let r=0;r<F;r++)C[z+r]=0;u(q,0,m,I,M,g,t,f,D,C,E);for(let r=0;r<F;r++)C[z+r]*=j}postMessage([t])};})();
